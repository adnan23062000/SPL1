(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"./src/util/tracing.ts":function(e,n,t){"use strict";t.r(n),t.d(n,"init",(function(){return c})),t.d(n,"extractSpan",(function(){return u})),t.d(n,"instrumentAppPerformance",(function(){return l}));var r=t("./node_modules/lightstep-tracer/browser.js"),o=t("./node_modules/opentracing/lib/index.js"),i=t("./src/store/actions/debug.ts"),s=t("./src/store/selectors/session.ts"),a=t("./src/util/performance.ts"),c=function(e){var n=e.name,t=e.host,i=e.token,s=e.appVersion,a=new r.Tracer({component_name:n,xhr_instrumentation:!1,access_token:i,collector_host:t,default_span_tags:{"component.version":s}});return Object(o.initGlobalTracer)(a),a},u=function(e,n){return n?e.extract(o.FORMAT_HTTP_HEADERS,n):null},l=function(e){var n=e.tracer,t=e.originalSpan,r=e.dispatch,c=e.reporter,u=e.userId,l=e.route,d=e.additionalSpanTags,f=(d=void 0===d?{}:d).isCustomDomain,p=void 0!==f&&f,g=d.performanceTags,m=void 0===g?[]:g,v=d.glyphEmbed,b=l?l.metricName:"unidentified",_={"user.logged_in":Object(s.a)(u),"req.route_name":b,"req.route":b,"req.glyph_embed":v,"req.is_custom_domain":p};m.forEach((function(e){return _["req.".concat(e)]=1}));var h={loggedIn:Object(s.a)(u),route:b,withinPostInternalLinksExperiment:m.includes("post_internal_links")},w=function(e){return Math.round(1e3*e)},M=function(e,t,r,o){var i=r.start,s=r.end,a=n.startSpan("timing.".concat(t),{childOf:e,tags:_}).setBeginMicros(w(i)).setEndMicros(w(s));return null!=o&&o(a),a.finish(),a};a.f.observe((function(e){var s,a,u,l;c.reportRender(h,e);var d=n.startSpan("timing.navigation",{references:[Object(o.followsFrom)(t)],tags:_}).setBeginMicros(w(e.load.start)).setEndMicros(w(e.load.end)).log({redirect_count:null!==(s=null===(a=window)||void 0===a||null===(u=a.performance)||void 0===u||null===(l=u.navigation)||void 0===l?void 0:l.redirectCount)&&void 0!==s?s:0});M(d,"beforeDomainLookup",e.beforeDomainLookup),M(d,"domainLookup",e.domainLookup),M(d,"connect",e.connect),M(d,"request",e.request),M(d,"response",e.response),M(d,"processing",e.processing);var f=e.overallFCP,p=e.client,g=e.render;null!=f&&M(d,"firstContentfulPaint",f),null!=p&&M(d,"client",p,(function(e){null!=g&&M(e,"render",g)})),d.finish(),r(Object(i.c)(d.generateTraceURL()))})),a.b.observe((function(e){c.reportFirstContentfulPaint(h,e),n.startSpan("timing.firstContentfulPaint.v2",{references:[Object(o.followsFrom)(t)],tags:_}).setBeginMicros(w(e.start)).setEndMicros(w(e.end)).finish()})),a.d.observe((function(e){c.reportLargestContentfulPaint(h,e),n.startSpan("timing.largestContentfulPaint",{references:[Object(o.followsFrom)(t)],tags:_}).setBeginMicros(w(e.start)).setEndMicros(w(e.end)).finish()})),a.g.observe((function(e){e&&c.reportUnsupportedPerfObserver(h)})),a.c.observe((function(e){c.reportInput(h,e),n.startSpan("timing.input.first.delay",{references:[Object(o.followsFrom)(t)],tags:_}).setBeginMicros(w(e.start)).setEndMicros(w(e.end)).finish()}))}}}]);
//# sourceMappingURL=tracing.558cf2ca.chunk.js.map